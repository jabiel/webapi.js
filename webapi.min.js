/*
 * webapi - easy access webservices
 * https://github.com/jabiel/webapi.js
 * (c) 2014-2015 MIT License, https://jabiel.pl
 */
!function(t){var e=function(t,e,n){function a(t){var a="";return a=t.data&&t.data.exceptionMessage?t.data.exceptionMessage:t.data&&t.data.message?t.data.message:t.statusText?t.status+" "+t.statusText:t,n.onError(a),e.reject(t)}function r(t){return t.data}function o(t){return 0==t.indexOf("http")?t:n.baseUrl+t}function u(){var t={},e=null!==localStorage.getItem("authData")?JSON.parse(localStorage.getItem("authData")):null;return e&&e.access_token&&(t.headers=t.headers||{},t.headers.Authorization="Bearer "+e.access_token),t}function s(e){return t.get(o(e),u()).then(r,a)}function c(t){if(g[t]){var n=e.defer();return n.resolve(g[t]),n.promise}return s(t).then(function(e){return g[t]=e,e})}function i(e,n){return t.post(o(e),n,u()).then(r,a)}function f(e,n){return t.put(o(e),n,u()).then(r,a)}function l(e){return t["delete"](o(e),u()).then(r,a)}function d(){g={}}function p(e,n){var r="grant_type=password&username="+e+"&password="+n;return t.post(o("token"),r,{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return localStorage.setItem("authData",JSON.stringify(t.data)),t.data})["catch"](a)}var g={};return{get:s,post:i,put:f,"delete":l,getc:c,clearc:d,login:p}};t.factory("webapi",e),e.$inject=["$http","$q","webapiConfig"],t.value("webapiConfig",{baseUrl:"",onError:function(t){console.error("webapi error:",t)}})}(angular.module("webapi",[]));